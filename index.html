<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trading Interface</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .trade-card {
      border-radius: 10px;
      padding: 20px;
      background: #ffffff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .btn-rise {
      background-color: #00c080;
      color: white;
    }
    .btn-fall {
      background-color: #d63447;
      color: white;
    }
    .btn-rise:hover {
      background-color: #009f66;
    }
    .btn-fall:hover {
      background-color: #b32436;
    }
    .balance-card {
      padding: 10px 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .badge-real {
      background-color: #007bff;
    }
    .badge-demo {
      background-color: #6c757d;
    }
  </style>
</head>
<body>

<div class="container py-5">

  <!-- Balance Section -->
  <div class="balance-card mb-4">
    <div>
      <span class="badge badge-demo p-2">Demo Account</span>
      <span id="demo-balance" class="ms-2 fw-bold">$0.00</span>
    </div>
    <div>
      <span class="badge badge-real p-2">Real Account</span>
      <span id="real-balance" class="ms-2 fw-bold text-primary">$0.00</span>
    </div>
  </div>

  <!-- Main Trading Interface -->
  <div class="row mb-4">
    <div class="col-md-6 mb-3">
      <label class="form-label">Market</label>
      <select id="market-select" class="form-select">
        <option value="R_25">Volatility 25 Index</option>
        <option value="R_10">Volatility 10 Index</option>
        <option value="R_50">Volatility 50 Index</option>
      </select>
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Trade Type</label>
      <select id="trade-type-select" class="form-select">
        <option value="RISEFALL">Rise/Fall</option>
        <option value="HIGHERLOWER">Higher/Lower</option>
      </select>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <label class="form-label">Start Time</label>
      <select id="start-time-select" class="form-select">
        <option value="now">Now</option>
        <option value="later">Later</option>
      </select>
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">Duration</label>
      <div class="input-group">
        <input id="duration-input" type="number" class="form-control" value="15" min="1">
        <select id="duration-unit-select" class="form-select">
          <option value="m">Minutes</option>
          <option value="h">Hours</option>
        </select>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">Stake</label>
      <div class="input-group">
        <input id="stake-input" type="number" class="form-control" value="10" min="1">
        <span class="input-group-text">USD</span>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="trade-card text-center">
        <h4 class="text-success">Rise</h4>
        <p><strong>Stake:</strong> <span id="rise-stake">10.00</span> USD</p>
        <p><strong>Payout:</strong> Auto</p>
        <button id="buy-rise" class="btn btn-rise w-100 mt-3">Purchase Rise</button>
      </div>
    </div>
    <div class="col-md-6">
      <div class="trade-card text-center">
        <h4 class="text-danger">Fall</h4>
        <p><strong>Stake:</strong> <span id="fall-stake">10.00</span> USD</p>
        <p><strong>Payout:</strong> Auto</p>
        <button id="buy-fall" class="btn btn-fall w-100 mt-3">Purchase Fall</button>
      </div>
    </div>
  </div>
</div>

<!-- WebSocket and Trading Logic -->
<script>
const app_id = 69656;
const token = "QSDAQPsfjphEvtT";

let ws = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${app_id}`);
let balances = { demo: 0, real: 0 };

ws.onopen = () => {
  console.log("WebSocket connected ✅");
  authorize();
};

function authorize() {
  ws.send(JSON.stringify({ authorize: token }));
}

ws.onmessage = (message) => {
  const data = JSON.parse(message.data);

  if (data.msg_type === "authorize") {
    console.log("Authorized ✅");
    getBalance();
  }

  if (data.msg_type === "balance") {
    if (data.balance.currency === "USD") {
      if (data.balance.landing_company_name === "virtual") {
        balances.demo = data.balance.balance;
      } else {
        balances.real = data.balance.balance;
      }
      updateBalanceDisplay();
    }
  }

  if (data.msg_type === "buy") {
    console.log("Purchase Success ✅", data);
    getBalance();
  }
};

function getBalance() {
  ws.send(JSON.stringify({ balance: 1, account: 'virtual' }));
  ws.send(JSON.stringify({ balance: 1, account: 'real' }));
}

function updateBalanceDisplay() {
  document.getElementById("demo-balance").innerText = `$${balances.demo.toFixed(2)}`;
  document.getElementById("real-balance").innerText = `$${balances.real.toFixed(2)}`;
}

function purchaseRiseFall(contract_type) {
  const stake = parseFloat(document.getElementById("stake-input").value);
  const duration = parseInt(document.getElementById("duration-input").value);
  const duration_unit = document.getElementById("duration-unit-select").value;
  const symbol = document.getElementById("market-select").value;

  ws.send(JSON.stringify({
    buy: 1,
    price: stake,
    parameters: {
      amount: stake,
      basis: "stake",
      contract_type: contract_type,
      currency: "USD",
      duration: duration,
      duration_unit: duration_unit,
      symbol: symbol
    }
  }));
}

document.getElementById("buy-rise").addEventListener("click", () => {
  purchaseRiseFall("RISE");
});

document.getElementById("buy-fall").addEventListener("click", () => {
  purchaseRiseFall("FALL");
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
